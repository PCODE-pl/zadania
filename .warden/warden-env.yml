version: "3.5"
services:
  nginx:
    volumes:
      - ./.warden/nginx/custom.conf:/etc/nginx/default.d/custom.conf
    networks:
      default:
        ipv4_address: 172.133.0.21

  php-fpm:
    volumes:
      - ./.warden/php/zz-config.ini:/etc/php.d/zz-config.ini
      - ./.warden/php/zz-config.ini:/etc/php-fpm.d/zz-config.ini
    networks:
      default:
        ipv4_address: 172.133.0.19

  php-debug:
    volumes:
      - ./.warden/php/zz-config.ini:/etc/php.d/zz-config.ini
      - ./.warden/php/zz-config.ini:/etc/php-fpm.d/zz-config.ini

    networks:
      default:
        ipv4_address: 172.133.0.20

  opensearch:
    environment:
      - discovery.type=single-node
      - indices.query.bool.max_clause_count=1024
      - indices.id_field_data.enabled=true
      - "cluster.routing.allocation.disk.watermark.low=98%"
      - "cluster.routing.allocation.disk.watermark.high=99%"
      - "cluster.routing.allocation.disk.watermark.flood_stage=99%"
      - "OPENSEARCH_JAVA_OPTS=-Xms1024m -Xmx1024m"
    networks:
      default:
        ipv4_address: 172.133.0.15

  db:
    ports:
      - "53777:3306"
    environment:
      - TZ=Europe/Berlin
    networks:
      default:
        ipv4_address: 172.133.0.17

  redis:
    networks:
      default:
        ipv4_address: 172.133.0.16

  rabbitmq:
    networks:
      default:
        ipv4_address: 172.133.0.18

networks:
  default:
    driver: bridge
    ipam:
     config:
       - subnet: 172.133.0.0/16
         gateway: 172.133.0.1
    labels:
      - "com.docker.compose.network=default"
      - "dev.warden.environment.name=zadania"
      - "dev.warden.environment.type=magento2"
